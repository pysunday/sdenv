const { jsdomFromText } = require('../');

/* 生成window挂载下的方法函数，复制到浏览器中运行后按到
const keys = 'window,self,document,name,location,customElements,history,navigation,locationbar,menubar,personalbar,scrollbars,statusbar,toolbar,status,closed,frames,length,top,opener,parent,frameElement,navigator,origin,external,screen,innerWidth,innerHeight,scrollX,pageXOffset,scrollY,pageYOffset,visualViewport,screenX,screenY,outerWidth,outerHeight,devicePixelRatio,event,clientInformation,screenLeft,screenTop,styleMedia,onsearch,isSecureContext,trustedTypes,performance,onappinstalled,onbeforeinstallprompt,crypto,indexedDB,sessionStorage,localStorage,onbeforexrselect,onabort,onbeforeinput,onbeforematch,onbeforetoggle,onblur,oncancel,oncanplay,oncanplaythrough,onchange,onclick,onclose,oncontentvisibilityautostatechange,oncontextlost,oncontextmenu,oncontextrestored,oncuechange,ondblclick,ondrag,ondragend,ondragenter,ondragleave,ondragover,ondragstart,ondrop,ondurationchange,onemptied,onended,onerror,onfocus,onformdata,oninput,oninvalid,onkeydown,onkeypress,onkeyup,onload,onloadeddata,onloadedmetadata,onloadstart,onmousedown,onmouseenter,onmouseleave,onmousemove,onmouseout,onmouseover,onmouseup,onmousewheel,onpause,onplay,onplaying,onprogress,onratechange,onreset,onresize,onscroll,onsecuritypolicyviolation,onseeked,onseeking,onselect,onslotchange,onstalled,onsubmit,onsuspend,ontimeupdate,ontoggle,onvolumechange,onwaiting,onwebkitanimationend,onwebkitanimationiteration,onwebkitanimationstart,onwebkittransitionend,onwheel,onauxclick,ongotpointercapture,onlostpointercapture,onpointerdown,onpointermove,onpointerrawupdate,onpointerup,onpointercancel,onpointerover,onpointerout,onpointerenter,onpointerleave,onselectstart,onselectionchange,onanimationend,onanimationiteration,onanimationstart,ontransitionrun,ontransitionstart,ontransitionend,ontransitioncancel,onafterprint,onbeforeprint,onbeforeunload,onhashchange,onlanguagechange,onmessage,onmessageerror,onoffline,ononline,onpagehide,onpageshow,onpopstate,onrejectionhandled,onstorage,onunhandledrejection,onunload,crossOriginIsolated,scheduler,alert,atob,blur,btoa,cancelAnimationFrame,cancelIdleCallback,captureEvents,clearInterval,clearTimeout,close,confirm,createImageBitmap,fetch,find,focus,getComputedStyle,getSelection,matchMedia,moveBy,moveTo,open,postMessage,print,prompt,queueMicrotask,releaseEvents,reportError,requestAnimationFrame,requestIdleCallback,resizeBy,resizeTo,scroll,scrollBy,scrollTo,setInterval,setTimeout,stop,structuredClone,webkitCancelAnimationFrame,webkitRequestAnimationFrame,chrome,launchQueue,originAgentCluster,onpageswap,onpagereveal,credentialless,fence,speechSynthesis,onscrollend,onscrollsnapchange,onscrollsnapchanging,webkitRequestFileSystem,webkitResolveLocalFileSystemURL,GetParams,__REDUX_DEVTOOLS_EXTENSION__,__REDUX_DEVTOOLS_EXTENSION_COMPOSE__,SdenvExtend,_ts,$_ts,_$a6,_$d3,_$ae,TEMPORARY,PERSISTENT,addEventListener,dispatchEvent,removeEventListener'.split(',');
JSON.stringify(keys.filter(key => typeof window[key] === 'function').map(key => ({
  key,
  len: window[key].length,
  name: window[key].name,
  type: typeof window[key],
  name_len: window[key].name.length
})))
*/

const chromeWindowFunctionResult = [{"key":"alert","len":0,"name":"alert","type":"function","name_len":5},{"key":"atob","len":1,"name":"atob","type":"function","name_len":4},{"key":"blur","len":0,"name":"blur","type":"function","name_len":4},{"key":"btoa","len":1,"name":"btoa","type":"function","name_len":4},{"key":"cancelAnimationFrame","len":1,"name":"cancelAnimationFrame","type":"function","name_len":20},{"key":"cancelIdleCallback","len":1,"name":"cancelIdleCallback","type":"function","name_len":18},{"key":"captureEvents","len":0,"name":"captureEvents","type":"function","name_len":13},{"key":"clearInterval","len":0,"name":"clearInterval","type":"function","name_len":13},{"key":"clearTimeout","len":0,"name":"clearTimeout","type":"function","name_len":12},{"key":"close","len":0,"name":"close","type":"function","name_len":5},{"key":"confirm","len":0,"name":"confirm","type":"function","name_len":7},{"key":"createImageBitmap","len":1,"name":"createImageBitmap","type":"function","name_len":17},{"key":"fetch","len":1,"name":"fetch","type":"function","name_len":5},{"key":"find","len":0,"name":"find","type":"function","name_len":4},{"key":"focus","len":0,"name":"focus","type":"function","name_len":5},{"key":"getComputedStyle","len":1,"name":"getComputedStyle","type":"function","name_len":16},{"key":"getSelection","len":0,"name":"getSelection","type":"function","name_len":12},{"key":"matchMedia","len":1,"name":"matchMedia","type":"function","name_len":10},{"key":"moveBy","len":2,"name":"moveBy","type":"function","name_len":6},{"key":"moveTo","len":2,"name":"moveTo","type":"function","name_len":6},{"key":"open","len":0,"name":"open","type":"function","name_len":4},{"key":"postMessage","len":1,"name":"postMessage","type":"function","name_len":11},{"key":"print","len":0,"name":"print","type":"function","name_len":5},{"key":"prompt","len":0,"name":"prompt","type":"function","name_len":6},{"key":"queueMicrotask","len":1,"name":"queueMicrotask","type":"function","name_len":14},{"key":"releaseEvents","len":0,"name":"releaseEvents","type":"function","name_len":13},{"key":"reportError","len":1,"name":"reportError","type":"function","name_len":11},{"key":"requestAnimationFrame","len":1,"name":"requestAnimationFrame","type":"function","name_len":21},{"key":"requestIdleCallback","len":1,"name":"requestIdleCallback","type":"function","name_len":19},{"key":"resizeBy","len":2,"name":"resizeBy","type":"function","name_len":8},{"key":"resizeTo","len":2,"name":"resizeTo","type":"function","name_len":8},{"key":"scroll","len":0,"name":"scroll","type":"function","name_len":6},{"key":"scrollBy","len":0,"name":"scrollBy","type":"function","name_len":8},{"key":"scrollTo","len":0,"name":"scrollTo","type":"function","name_len":8},{"key":"setInterval","len":1,"name":"setInterval","type":"function","name_len":11},{"key":"setTimeout","len":1,"name":"setTimeout","type":"function","name_len":10},{"key":"stop","len":0,"name":"stop","type":"function","name_len":4},{"key":"structuredClone","len":1,"name":"structuredClone","type":"function","name_len":15},{"key":"webkitCancelAnimationFrame","len":1,"name":"webkitCancelAnimationFrame","type":"function","name_len":26},{"key":"webkitRequestAnimationFrame","len":1,"name":"webkitRequestAnimationFrame","type":"function","name_len":27},{"key":"webkitRequestFileSystem","len":3,"name":"webkitRequestFileSystem","type":"function","name_len":23},{"key":"webkitResolveLocalFileSystemURL","len":2,"name":"webkitResolveLocalFileSystemURL","type":"function","name_len":31},{"key":"addEventListener","len":2,"name":"addEventListener","type":"function","name_len":16},{"key":"dispatchEvent","len":1,"name":"dispatchEvent","type":"function","name_len":13},{"key":"removeEventListener","len":2,"name":"removeEventListener","type":"function","name_len":19}];


const { window } = jsdomFromText('', {
  url: 'http://test.com/path/to',
  referrer: 'http://test.com/path/to',
  contentType: "text/html",
  runScripts: "outside-only",
})

describe('windows属性检测', () => {
  test('函数属性检测', () => {
    for (let item of chromeWindowFunctionResult) {
      const tar = window[item.key]
      // console.log(item);
      expect(typeof tar).toBe(item.type);
      expect(tar.name).toBe(item.name);
      expect(tar.length).toBe(item.len);
      expect(tar.name.length).toBe(item.name_len);
    }
  });
});
